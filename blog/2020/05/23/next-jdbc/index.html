<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>An Architect&#39;s View: next.jdbc Compendium</title>
    
<meta name="keywords" content="diversity,frege,clojure,boot,conferences,process,java,community,jdbc,conj,leiningen,javascript">

<meta name="description" content="seancorfield/next.jdbc 1.0.445This morning I released 1.0.445 and realized it&#39;s the sixth release since I last mentioned it in a blog post, so I thought it would be helpful to summarize all of the changes made so far in 2020. 1.0.13 came out at the end of December and I decided to switch from MAJOR.MINOR.PATCH versioning to MAJOR.MINOR.COMMITS versioning since I&#39;d already made the commitment to no breaking changes -- only fixative/accretive changes -- when the library originally moved from Alpha to Beta a year ago.">

<meta property="og:description" content="seancorfield/next.jdbc 1.0.445This morning I released 1.0.445 and realized it&#39;s the sixth release since I last mentioned it in a blog post, so I thought it would be helpful to summarize all of the changes made so far in 2020. 1.0.13 came out at the end of December and I decided to switch from MAJOR.MINOR.PATCH versioning to MAJOR.MINOR.COMMITS versioning since I&#39;d already made the commitment to no breaking changes -- only fixative/accretive changes -- when the library originally moved from Alpha to Beta a year ago.">

<meta property="og:url" content="https://corfield.org/blog/2020/05/23/next-jdbc/" />
<meta property="og:title" content="next.jdbc Compendium" />
<meta property="og:type" content="article" />

    <link rel="canonical" href="https://corfield.org/blog/2020/05/23/next-jdbc/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header right">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">An Architect&#39;s View</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse right">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages/presentations/">Presentations</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">May 23, 2020</div>
        
    </div>
    <h2>next.jdbc Compendium</h2>
</div>
<div>
    
    <h2 id="seancorfieldnextjdbc-10445">seancorfield/next.jdbc 1.0.445</h2><p>This morning I released <a href="https://github.com/seancorfield/next-jdbc/releases/tag/v1.0.445">1.0.445</a> and realized it's the sixth release since I last mentioned it in a blog post, so I thought it would be helpful to summarize all of the changes made so far in 2020. 1.0.13 came out at the end of December and I decided to switch from MAJOR.MINOR.PATCH versioning to MAJOR.MINOR.COMMITS versioning since I'd already made the commitment to no breaking changes -- only fixative/accretive changes -- when the library originally moved from Alpha to Beta a year ago.</p><p>Unlike the change log and release notes which are chronological, this post is organized into fixative changes, accretive changes, and documentation improvements, with each section organized by functionality or by database as appropriate.<!-- more --></p><h3 id="bug-fixes">Bug Fixes</h3><ul><li><code>next.jdbc.result-set</code><ul><li>Fixed an edge case in how qualified column names are constructed when either the table name is unavailable or the <code>:qualifier-fn</code> results <code>nil</code> or an empty string.</li><li>Fixed how <code>:qualifier-fn</code> is used when the table name is unavailable so that <code>:qualifier-fn (constantly "qual")</code> works the same way as <code>clojure.java.jdbc</code>'s <code>:qualifier "qual"</code> option, which makes migration easier, as well as making use of <code>:qualifier-fn</code> more consistent.</li><li>Improved performance of some result set building code (poor performance is a bug!).</li></ul></li></ul><h3 id="enhancements">Enhancements</h3><ul><li><code>next.jdbc/plan</code><ul><li>Added <code>InspectableMapifiedResultSet</code> protocol that provides "meta" information access from the abstract row that is passed into the reducing function used on the <code>IReduceInit</code> produced by <code>plan</code>. Currently, this exposes the current <code>row-number</code> (from the underlying <code>ResultSet</code>) and the <code>column-names</code> -- a vector of column name keywords, in "natural" order based on the SQL query, produced by the builder function passed into <code>plan</code>. These functions are only available from <code>plan</code> (or a <code>datafiable-row</code> produced from <code>plan</code>) -- they are not available on the results of <code>execute!</code> or <code>execute-one!</code> -- and additional functions will probably be added over time.</li><li>Use of <code>plan</code> with array-based builders has been made easier by adding support for numeric <code>Associative</code> keys and <code>Indexed</code> access (<code>nth</code>) to read column values by index, instead of by label.</li></ul></li><li><code>next.jdbc/with-transaction</code><ul><li>If you call this with an existing <code>Connection</code>, it is mutated to set up and commit (or rollback) the transaction. This made concurrent execution unpredictable so this is now synchronized via <code>locking</code>. It is recommended to use <code>with-transaction</code> on a <code>DataSource</code> anyway, but this makes the <code>Connection</code> case more predictable.</li></ul></li><li><code>next.jdbc.connection</code><ul><li>Improved the error messages when an unknown <code>:dbtype</code> is used and clarified how to use <code>:classname</code>.</li><li>Added <code>component</code> function for built-in support of the <a href="https://github.com/stuartsierra/component">Component library</a> when creating a connection pooled datasource. Note that Component is not a dependency so you can simply ignore this feature if you don't use Component.</li><li>The result of calling <code>get-datasource</code> on a db-spec hash map now supports <code>.getLoginTimeout</code> and <code>.setLoginTimeout</code> to match <code>javax.sql.DataSource</code> and improve <code>next.jdbc</code>'s support for timeouts.</li><li>MariaDB is supported out of the box.</li></ul></li><li><code>next.jdbc.date-time</code><ul><li>Add <code>read-as-instant</code> and <code>read-as-local</code> functions to extend <code>ReadableColumn</code> so that SQL <code>DATE</code> and <code>TIMESTAMP</code> columns can be read as Java Time types.</li></ul></li><li><code>next.jdbc.specs</code><ul><li>The Spec for JDBC URL strings explicitly requires that they start with <code>jdbc:</code> to match the behavior of the code (and the JDBC specification), which can improve error messages when you use <code>instrument</code>.</li></ul></li><li>Options:
<ul><li><code>:return-keys</code> now accepts both keywords and strings in the vector of keys to return (the documentation, code, and Spec were in conflict so allowing both was the safest choice).</li></ul></li></ul><h3 id="documentation">Documentation</h3><p>I try to improve the documentation in each release, based on feedback via Slack and GitHub. The bullet points below are what I consider to be just the most notable improvements.</p><ul><li><strong>README</strong><ul><li>Promote the stable documentation on <a href="https://cljdoc.org/d/seancorfield/next.jdbc">cljdoc.org</a> and make it clear the GitHub documentation is for changes made since the last release.</li></ul></li><li><strong>Getting Started</strong><ul><li>Make it clearer that <code>plan</code> requires <code>reduce</code> or some sort of reduction process.</li><li>Shows how to work with database metadata (this information was previously only mentioned in the <code>clojure.java.jdbc</code> migration guide).</li></ul></li><li><strong>Tips &amp; Tricks</strong><ul><li>This has been split out from <strong>Friendly SQL Functions</strong> and now contains a lot more information.</li><li>Timeouts: Four different types of timeout are explained, along with how <code>next.jdbc</code> supports them.</li><li>MySQL: How to stream result sets; <code>BLOB</code> columns are returned as <code>byte[]</code>, not <code>java.sql.Blob</code>.</li><li>PostgreSQL: How to stream result sets; Examples of how to work with SQL array types; Clarify the need for <code>next.jdbc.date-time</code> for <code>java.util.Date</code> conversion (this is also mentioned in <strong>Getting Started</strong>).</li></ul></li><li><code>next.jdbc.prepare/execute-batch!</code> now has an example of how to get generated keys from a batch insert.</li></ul><h2 id="thanks">Thanks!</h2><p>As always, thanks to everyone who uses <code>next.jdbc</code>, thanks to everyone who has provided feedback (especially on the documentation), reported bugs, suggested improvements, or sent pull requests. <code>next.jdbc</code> wouldn't be what it is today without all that input!</p><p>See the <a href="https://github.com/seancorfield/next-jdbc/blob/master/CHANGELOG.md">change log</a> for all the changes in release order and <a href="https://cljdoc.org/d/seancorfield/next.jdbc">cljdoc.org</a> for overall documentation of the latest release.</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/clojure/">clojure</a>
    
    <a href="/tags/jdbc/">jdbc</a>
    
</div>


    <div id="prev-next">
        
        <a href="/blog/2020/10/25/next-jdbc/">&laquo; next.jdbc Compendium II</a>
        
        
        <a class="right" href="/blog/2019/12/31/releases/">Happy New Releases! &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = "https://corfield.org/blog/2020/05/23/next-jdbc/";
            this.page.identifier = "next.jdbc Compendium";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//seancorfield.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <h3>About This Blog</h3>
                <p>Sean Corfield, Software Architect, offers his views on the world of software development.</p>
                <p class="smallprint">Masthead image &copy; Vernon Viehe.</p>
                
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/blog/2020/10/25/next-jdbc/">next.jdbc Compendium II</a></li>
                        
                        <li><a href="/blog/2020/05/23/next-jdbc/">next.jdbc Compendium</a></li>
                        
                        <li><a href="/blog/2019/12/31/releases/">Happy New Releases!</a></li>
                        
                        <li><a href="/blog/2019/09/13/using-spec/">How do you use clojure.spec</a></li>
                        
                        <li><a href="/blog/2019/08/07/releases/">Release! Release! Release!</a></li>
                        
                    </ul>
                </div>
                
                
                <div id="tags">
                    <h3>Tags</h3>
                    <ul>
                        
                        <li><a href="/tags/diversity/">diversity</a></li>
                        
                        <li><a href="/tags/frege/">frege</a></li>
                        
                        <li><a href="/tags/clojure/">clojure</a></li>
                        
                        <li><a href="/tags/boot/">boot</a></li>
                        
                        <li><a href="/tags/conferences/">conferences</a></li>
                        
                        <li><a href="/tags/process/">process</a></li>
                        
                        <li><a href="/tags/java/">java</a></li>
                        
                        <li><a href="/tags/community/">community</a></li>
                        
                        <li><a href="/tags/jdbc/">jdbc</a></li>
                        
                        <li><a href="/tags/conj/">conj</a></li>
                        
                        <li><a href="/tags/leiningen/">leiningen</a></li>
                        
                        <li><a href="/tags/javascript/">javascript</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2020 Sean Corfield
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
