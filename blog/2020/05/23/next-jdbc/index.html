
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>next.jdbc Compendium - An Architect's View</title>
  <meta name="author" content="Sean Corfield">

  
  <meta name="description" content="seancorfield/next.jdbc 1.0.445 This morning I released 1.0.445 and realized it&rsquo;s the sixth release since I last mentioned it in a blog post, so &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://corfield.org/blog/2020/05/23/next-jdbc">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="An Architect's View" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">An Architect's View</a></h1>
  
    <h2>Clojure, Software Design, Frameworks and more...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:corfield.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/presentations">Presentations</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">next.jdbc Compendium</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-05-23T13:55:00-07:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2020</span></span> <span class='time'>1:55 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="https://corfield.org">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>seancorfield/next.jdbc 1.0.445</h2>

<p>This morning I released <a href="https://github.com/seancorfield/next-jdbc/releases/tag/v1.0.445">1.0.445</a> and realized it&rsquo;s the sixth release since I last mentioned it in a blog post, so I thought it would be helpful to summarize all of the changes made so far in 2020. 1.0.13 came out at the end of December and I decided to switch from MAJOR.MINOR.PATCH versioning to MAJOR.MINOR.COMMITS versioning since I&rsquo;d already made the commitment to no breaking changes &ndash; only fixative/accretive changes &ndash; when the library originally moved from Alpha to Beta a year ago.</p>

<p>Unlike the change log and release notes which are chronological, this post is organized into fixative changes, accretive changes, and documentation improvements, with each section organized by functionality or by database as appropriate.<!-- more --></p>

<h3>Bug Fixes</h3>

<ul>
<li><code>next.jdbc.result-set</code>

<ul>
<li>Fixed an edge case in how qualified column names are constructed when either the table name is unavailable or the <code>:qualifier-fn</code> results <code>nil</code> or an empty string.</li>
<li>Fixed how <code>:qualifier-fn</code> is used when the table name is unavailable so that <code>:qualifier-fn (constantly "qual")</code> works the same way as <code>clojure.java.jdbc</code>&rsquo;s <code>:qualifier "qual"</code> option, which makes migration easier, as well as making use of <code>:qualifier-fn</code> more consistent.</li>
<li>Improved performance of some result set building code (poor performance is a bug!).</li>
</ul>
</li>
</ul>


<h3>Enhancements</h3>

<ul>
<li><code>next.jdbc/plan</code>

<ul>
<li>Added <code>InspectableMapifiedResultSet</code> protocol that provides &ldquo;meta&rdquo; information access from the abstract row that is passed into the reducing function used on the <code>IReduceInit</code> produced by <code>plan</code>. Currently, this exposes the current <code>row-number</code> (from the underlying <code>ResultSet</code>) and the <code>column-names</code> &ndash; a vector of column name keywords, in &ldquo;natural&rdquo; order based on the SQL query, produced by the builder function passed into <code>plan</code>. These functions are only available from <code>plan</code> (or a <code>datafiable-row</code> produced from <code>plan</code>) &ndash; they are not available on the results of <code>execute!</code> or <code>execute-one!</code> &ndash; and additional functions will probably be added over time.</li>
<li>Use of <code>plan</code> with array-based builders has been made easier by adding support for numeric <code>Associative</code> keys and <code>Indexed</code> access (<code>nth</code>) to read column values by index, instead of by label.</li>
</ul>
</li>
<li><code>next.jdbc/with-transaction</code>

<ul>
<li>If you call this with an existing <code>Connection</code>, it is mutated to set up and commit (or rollback) the transaction. This made concurrent execution unpredictable so this is now synchronized via <code>locking</code>. It is recommended to use <code>with-transaction</code> on a <code>DataSource</code> anyway, but this makes the <code>Connection</code> case more predictable.</li>
</ul>
</li>
<li><code>next.jdbc.connection</code>

<ul>
<li>Improved the error messages when an unknown <code>:dbtype</code> is used and clarified how to use <code>:classname</code>.</li>
<li>Added <code>component</code> function for built-in support of the <a href="https://github.com/stuartsierra/component">Component library</a> when creating a connection pooled datasource. Note that Component is not a dependency so you can simply ignore this feature if you don&rsquo;t use Component.</li>
<li>The result of calling <code>get-datasource</code> on a db-spec hash map now supports <code>.getLoginTimeout</code> and <code>.setLoginTimeout</code> to match <code>javax.sql.DataSource</code> and improve <code>next.jdbc</code>&rsquo;s support for timeouts.</li>
<li>MariaDB is supported out of the box.</li>
</ul>
</li>
<li><code>next.jdbc.date-time</code>

<ul>
<li>Add <code>read-as-instant</code> and <code>read-as-local</code> functions to extend <code>ReadableColumn</code> so that SQL <code>DATE</code> and <code>TIMESTAMP</code> columns can be read as Java Time types.</li>
</ul>
</li>
<li><code>next.jdbc.specs</code>

<ul>
<li>The Spec for JDBC URL strings explicitly requires that they start with <code>jdbc:</code> to match the behavior of the code (and the JDBC specification), which can improve error messages when you use <code>instrument</code>.</li>
</ul>
</li>
<li>Options:

<ul>
<li><code>:return-keys</code> now accepts both keywords and strings in the vector of keys to return (the documentation, code, and Spec were in conflict so allowing both was the safest choice).</li>
</ul>
</li>
</ul>


<h3>Documentation</h3>

<p>I try to improve the documentation in each release, based on feedback via Slack and GitHub. The bullet points below are what I consider to be just the most notable improvements.</p>

<ul>
<li><strong>README</strong>

<ul>
<li>Promote the stable documentation on <a href="https://cljdoc.org/d/seancorfield/next.jdbc">cljdoc.org</a> and make it clear the GitHub documentation is for changes made since the last release.</li>
</ul>
</li>
<li><strong>Getting Started</strong>

<ul>
<li>Make it clearer that <code>plan</code> requires <code>reduce</code> or some sort of reduction process.</li>
<li>Shows how to work with database metadata (this information was previously only mentioned in the <code>clojure.java.jdbc</code> migration guide).</li>
</ul>
</li>
<li><strong>Tips &amp; Tricks</strong>

<ul>
<li>This has been split out from <strong>Friendly SQL Functions</strong> and now contains a lot more information.</li>
<li>Timeouts: Four different types of timeout are explained, along with how <code>next.jdbc</code> supports them.</li>
<li>MySQL: How to stream result sets; <code>BLOB</code> columns are returned as <code>byte[]</code>, not <code>java.sql.Blob</code>.</li>
<li>PostgreSQL: How to stream result sets; Examples of how to work with SQL array types; Clarify the need for <code>next.jdbc.date-time</code> for <code>java.util.Date</code> conversion (this is also mentioned in <strong>Getting Started</strong>).</li>
</ul>
</li>
<li><code>next.jdbc.prepare/execute-batch!</code> now has an example of how to get generated keys from a batch insert.</li>
</ul>


<h2>Thanks!</h2>

<p>As always, thanks to everyone who uses <code>next.jdbc</code>, thanks to everyone who has provided feedback (especially on the documentation), reported bugs, suggested improvements, or sent pull requests. <code>next.jdbc</code> wouldn&rsquo;t be what it is today without all that input!</p>

<p>See the <a href="https://github.com/seancorfield/next-jdbc/blob/master/CHANGELOG.md">change log</a> for all the changes in release order and <a href="https://cljdoc.org/d/seancorfield/next.jdbc">cljdoc.org</a> for overall documentation of the latest release.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sean Corfield</span></span>

      




<time class='entry-date' datetime='2020-05-23T13:55:00-07:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2020</span></span> <span class='time'>1:55 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/clojure/'>clojure</a>, <a class='category' href='/blog/categories/jdbc/'>jdbc</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://corfield.org/blog/2020/05/23/next-jdbc/" data-via="seancorfield" data-counturl="https://corfield.org/blog/2020/05/23/next-jdbc/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2019/12/31/releases/" title="Previous Post: Happy New Releases!">&laquo; Happy New Releases!</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Sean Corfield, Software Architect, offers his views on the world of software development.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/05/23/next-jdbc/">next.jdbc Compendium</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/12/31/releases/">Happy New Releases!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/09/13/using-spec/">How Do You Use clojure.spec</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/07/releases/">Release! Release! Release!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/07/04/next-jdbc/">Next.JDBC to 1.0.0 and Beyond!</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/seancorfield"  data-widget-id="480131406987673601"  data-link-color="#1863a1" data-tweet-limit="4" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @seancorfield</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </ul>
  
    <a href="http://twitter.com/seancorfield" class="twitter-follow-button" data-show-count="true">Follow @seancorfield</a>
  
</section>



<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/seancorfield">@seancorfield</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'seancorfield',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>
<section>
  <a href="https://github.com/framework-one">@framework-one</a> on GitHub
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+SeanCorfield_A?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32" alt="G+" title="G+" border="0">
      Google+
    </a>
  </h1>
</section>



<section class="googleplus">
  <h1>
    <a href="https://www.linkedin.com/in/seancorfield">
      <img src="https://static.licdn.com/scds/common/u/img/logos/logo_linkedin_92x22.png" width="92" height="22" alt="LinkedIn" title="LinkedIn" border="0">
    </a>
  </h1>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Sean Corfield -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'seancorfield';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://corfield.org/blog/2020/05/23/next-jdbc/';
        var disqus_url = 'https://corfield.org/blog/2020/05/23/next-jdbc/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
